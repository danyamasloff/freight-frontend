# Интеграция Яндекс Карт в Route Planner

## Что реализовано

✅ **Обновленная страница планирования маршрутов `/routes/planner`**

- Современный интерфейс с использованием @pbe/react-yandex-maps
- Геокодирование адресов через API Яндекс Карт и бэкенд
- Интерактивная карта с поддержкой Placemark и Polyline
- Интеграция с API бэкенда для расчета маршрутов
- Выбор транспорта и водителя
- Детальная аналитика маршрута (экономика, риски, детали)

✅ **Компоненты карты**

- RoutePlannerMap с withYMaps HOC
- Геокодирование и маршрутизация
- Элементы управления (геолокация, трафик, полноэкранный режим)
- Отображение маршрута с метками начала и конца

✅ **API интеграция**

- Подключение к `/api/routes/plan` бэкенда
- Геокодирование через `/api/geocoding/search`
- Мок-данные для разработки без бэкенда
- Обработка ошибок и фолбэки

## Настройка

### 1. API ключ Яндекс Карт

Добавьте в файл `.env` ваш API ключ:

```env
VITE_YANDEX_MAPS_API_KEY=ваш_api_ключ_яндекс_карт
```

Получить ключ можно в [Кабинете разработчика Яндекс](https://developer.tech.yandex.ru/)

### 2. Зависимости

Библиотека @pbe/react-yandex-maps уже установлена:

```json
"@pbe/react-yandex-maps": "^1.2.5"
```

### 3. Использование

Откройте страницу `/routes/planner` в браузере:

1. Введите адреса отправления и назначения
2. Выберите транспорт и водителя (опционально)
3. Нажмите "Построить маршрут"
4. Изучите детальную аналитику маршрута

## Функции

### Геокодирование

- Поиск адресов через API бэкенда
- Фолбэк на мок-данные для популярных городов
- Отображение координат

### Планирование маршрутов

- Расчет маршрута через API бэкенда `/api/routes/plan`
- Мок-данные при недоступности API
- Учет параметров транспорта и водителя

### Интерактивная карта

- Отображение точек А и В
- Линия маршрута
- Элементы управления
- Автомасштабирование по маршруту

### Аналитика

- **Экономика**: стоимость топлива, платные дороги, оплата водителя
- **Риски**: погода, качество дорог, трафик
- **Детали**: информация о маршруте и транспорте

## Разработка

### Мок-данные

При недоступности бэкенда используются мок-данные:

- Транспорт: KAMAZ 5490, MAN TGX
- Водители: Иван Петров, Сергей Сидоров
- Города: Москва, СПб, Новосибирск, Екатеринбург и др.

### API endpoints

```typescript
// Геокодирование
GET /api/geocoding/search?query={address}

// Планирование маршрута
POST /api/routes/plan
{
  startLat, startLon, endLat, endLon,
  startAddress, endAddress,
  vehicleId, driverId, ...options
}

// Транспорт и водители
GET /api/fleet/vehicles
GET /api/drivers
```

## Troubleshooting

1. **Карта не загружается**: проверьте VITE_YANDEX_MAPS_API_KEY
2. **Геокодирование не работает**: API бэкенда недоступен, используются мок-данные
3. **Ошибки линтера**: исправлены основные проблемы с типами и синтаксисом

## TODO

- [ ] Получить валидный API ключ Яндекс Карт
- [ ] Настроить бэкенд API endpoints
- [ ] Добавить больше типов транспорта
- [ ] Улучшить обработку ошибок
- [ ] Добавить сохранение маршрутов
